//package com.revpasswordmanager.ui;
//
//import com.revpasswordmanager.service.*;
//import com.revpasswordmanager.validation.EmailValidator;
//
//
//import java.util.Scanner;
//
//public class MainMenu {
//
//    public static void main(String[] args) throws Exception {
//
//        Scanner sc = new Scanner(System.in);
//        UserService userService = new UserService();
//        PasswordService passwordService = new PasswordService();
//        SecurityService securityService = new SecurityService();
//
//        int userId = -1;
//
//        while (true) {
//            try {
//
//                // =========================
//                // BEFORE LOGIN MENU
//                // =========================
//                if (userId < 0) {
//
//                    System.out.println("\n==============================");
//                    System.out.println("1. Register");
//                    System.out.println("2. Login");
//                    System.out.println("3. Forgot Password");
//                    System.out.println("4. Exit");
//                    System.out.print("Enter your choice: ");
//
//                    int choice = Integer.parseInt(sc.nextLine());
//
//                    switch (choice) {
//
//                        case 1: {   // Register
//                            System.out.print("Name: ");
//                            String name = sc.nextLine();
//
//                            System.out.print("Email: ");
//                            String email = sc.nextLine();
//                            if (!EmailValidator.isValid(email)) {
//                                System.out.println("Invalid email format");
//                                break;
//                            }
//
//                            System.out.print("Password: ");
//                            String password = sc.nextLine();
//
//                            System.out.print("Security question: ");
//                            String question = sc.nextLine();
//
//                            System.out.print("Security answer: ");
//                            String answer = sc.nextLine();
//
//                            try {
//                                userService.registerWithSecurityQuestion(
//                                        name, email, password, question, answer);
//                                System.out.println("Registered successfully");
//                            } catch (IllegalArgumentException e) {
//                                System.out.println("Registration failed: " + e.getMessage());
//                            }
//                            break;
//                        }
//
//                        case 2: {   // Login
//                            System.out.print("Email: ");
//                            String email = sc.nextLine();
//
//                            System.out.print("Password: ");
//                            String password = sc.nextLine();
//
//                            userId = userService.login(email, password);
//
//                            if (userId > 0) {
//                                System.out.println("Login successful");
//                            } else {
//                                System.out.println("Invalid credentials");
//                            }
//                            break;
//                        }
//
//                        case 3: {   // Forgot Password
//                            System.out.print("Enter registered email: ");
//                            String email = sc.nextLine();
//
//                            int uid = userService.findUserByEmail(email);
//                            if (uid < 0) {
//                                System.out.println("Email not found");
//                                break;
//                            }
//
//                            String question = securityService.getQuestion(uid);
//                            System.out.println("Security Question: " + question);
//
//                            System.out.print("Enter your answer: ");
//                            String answer = sc.nextLine();
//
//                            if (!securityService.validate(uid, answer)) {
//                                System.out.println("Incorrect security answer");
//                                break;
//                            }
//
//                            String code = securityService.getCode(uid);
//                            System.out.println("Verification Code (demo): " + code);
//
//                            System.out.print("Enter verification code: ");
//                            String enteredCode = sc.nextLine();
//
//                            if (!securityService.verifyCode(uid, enteredCode)) {
//                                System.out.println("Invalid or expired code");
//                                break;
//                            }
//
//                            System.out.print("Enter new master password: ");
//                            String newPassword = sc.nextLine();
//
//                            userService.resetPassword(uid, newPassword);
//                            System.out.println("Password reset successful");
//                            break;
//                        }
//
//                        case 4:
//                            System.out.println("Exiting application");
//                            sc.close();
//                            System.exit(0);
//
//                        default:
//                            System.out.println("Invalid choice");
//                    }
//                }
//
//                // =========================
//                // AFTER LOGIN MENU
//                // =========================
//                else {
//
//                    System.out.println("\n==============================");
//                    System.out.println("1. Update Master Profile");
//                    System.out.println("2. Add Password");
//                    System.out.println("3. List Of All Passwords");
//                    System.out.println("4. View Single Account Password");
//                    System.out.println("5. Update Account Password");
//                    System.out.println("6. Delete Account Name ");
//                    System.out.println("7. Logout");
//                    System.out.println("8. Exit");
//                    System.out.print("Enter your choice: ");
//
//                    int choice = Integer.parseInt(sc.nextLine());
//
//                    switch (choice) {
//
//                    case 1: {   // Update Profile Menu
//
//                        System.out.println("\n--- Update Profile ---");
//                        System.out.println("1. Change Name");
//                        System.out.println("2. Change Email");
//                        System.out.println("3. Change Master Password");
//                        System.out.println("4. Back");
//                        System.out.print("Choose option: ");
//
//                        int opt = Integer.parseInt(sc.nextLine());
//
//                        switch (opt) {
//
//                            case 1: {   // Change Name
//                                System.out.print("Enter new name: ");
//                                String newName = sc.nextLine();
//
//                                boolean updated = userService.updateName(userId, newName);
//                                System.out.println(updated ? "Name updated successfully" : "Update failed");
//                                break;
//                            }

                            package com.revpasswordmanager.ui;

                            import com.revpasswordmanager.service.*;
                            import com.revpasswordmanager.validation.EmailValidator;


                            import java.util.Scanner;

                            public class MainMenu {

                                public static void main(String[] args) throws Exception {

                                    Scanner sc = new Scanner(System.in);
                                    UserService userService = new UserService();
                                    PasswordService passwordService = new PasswordService();
                                    SecurityService securityService = new SecurityService();

                                    int userId = -1;

                                    while (true) {
                                        try {

                                            // =========================
                                            // BEFORE LOGIN MENU
                                            // =========================
                                            if (userId < 0) {

                                                System.out.println("\n==============================");
                                                System.out.println("1. Register");
                                                System.out.println("2. Login");
                                                System.out.println("3. Forgot Password");
                                                System.out.println("4. Exit");
                                                System.out.print("Enter your choice: ");

                                                int choice = Integer.parseInt(sc.nextLine());

                                                switch (choice) {

                                                    case 1: {   // Register
                                                        System.out.print("Name: ");
                                                        String name = sc.nextLine();

                                                        System.out.print("Email: ");
                                                        String email = sc.nextLine();
                                                        if (!EmailValidator.isValid(email)) {
                                                            System.out.println("Invalid email format");
                                                            break;
                                                        }

                                                        System.out.print("Password: ");
                                                        String password = sc.nextLine();

                                                        System.out.print("Security question: ");
                                                        String question = sc.nextLine();

                                                        System.out.print("Security answer: ");
                                                        String answer = sc.nextLine();

                                                        try {
                                                            userService.registerWithSecurityQuestion(
                                                                    name, email, password, question, answer);
                                                            System.out.println("Registered successfully");
                                                        } catch (IllegalArgumentException e) {
                                                            System.out.println("Registration failed: " + e.getMessage());
                                                        }
                                                        break;
                                                    }

                                                    case 2: {   // Login
                                                        System.out.print("Email: ");
                                                        String email = sc.nextLine();

                                                        System.out.print("Password: ");
                                                        String password = sc.nextLine();

                                                        userId = userService.login(email, password);

                                                        if (userId > 0) {
                                                            System.out.println("Login successful");
                                                        } else {
                                                            System.out.println("Invalid credentials");
                                                        }
                                                        break;
                                                    }

                                                    case 3: {   // Forgot Password
                                                        System.out.print("Enter registered email: ");
                                                        String email = sc.nextLine();

                                                        int uid = userService.findUserByEmail(email);
                                                        if (uid < 0) {
                                                            System.out.println("Email not found");
                                                            break;
                                                        }

                                                        String question = securityService.getQuestion(uid);
                                                        System.out.println("Security Question: " + question);

                                                        System.out.print("Enter your answer: ");
                                                        String answer = sc.nextLine();

                                                        if (!securityService.validate(uid, answer)) {
                                                            System.out.println("Incorrect security answer");
                                                            break;
                                                        }

                                                        String code = securityService.getCode(uid);
                                                        System.out.println("Verification Code (demo): " + code);

                                                        System.out.print("Enter verification code: ");
                                                        String enteredCode = sc.nextLine();

                                                        if (!securityService.verifyCode(uid, enteredCode)) {
                                                            System.out.println("Invalid or expired code");
                                                            break;
                                                        }

                                                        System.out.print("Enter new master password: ");
                                                        String newPassword = sc.nextLine();

                                                        userService.resetPassword(uid, newPassword);
                                                        System.out.println("Password reset successful");
                                                        break;
                                                    }

                                                    case 4:
                                                        System.out.println("Exiting application");
                                                        sc.close();
                                                        System.exit(0);

                                                    default:
                                                        System.out.println("Invalid choice");
                                                }
                                            }

                                            // =========================
                                            // AFTER LOGIN MENU
                                            // =========================
                                            else {

                                                System.out.println("\n==============================");
                                                System.out.println("1. Update Master Profile");
                                                System.out.println("2. Add Password");
                                                System.out.println("3. List Of All Passwords");
                                                System.out.println("4. View Single Account Password");
                                                System.out.println("5. Update Account Password");
                                                System.out.println("6. Delete Account Name ");
                                                System.out.println("7. Logout");
                                                System.out.println("8. Exit");
                                                System.out.print("Enter your choice: ");

                                                int choice = Integer.parseInt(sc.nextLine());

                                                switch (choice) {

                                                case 1: {   // Update Profile Menu

                                                    System.out.println("\n--- Update Profile ---");
                                                    System.out.println("1. Change Name");
                                                    System.out.println("2. Change Email");
                                                    System.out.println("3. Change Master Password");
                                                    System.out.println("4. Back");
                                                    System.out.print("Choose option: ");

                                                    int opt = Integer.parseInt(sc.nextLine());

                                                    switch (opt) {

                                                        case 1: {   // Change Name
                                                            System.out.print("Enter new name: ");
                                                            String newName = sc.nextLine();

                                                            boolean updated = userService.updateName(userId, newName);
                                                            System.out.println(updated ? "Name updated successfully" : "Update failed");
                                                            break;
                                                        }

                                                        case 2: {   // Change Email
                                                            System.out.print("Enter new email: ");
                                                            String newEmail = sc.nextLine();

                                                            if (!EmailValidator.isValid(newEmail)) {
                                                                System.out.println("Invalid email format");
                                                                break;
                                                            }

                                                            boolean updated = userService.updateEmail(userId, newEmail);
                                                            System.out.println(updated ? "Email updated successfully" : "Update failed");
                                                            break;
                                                        }

                                                        case 3: {   // Change Password (secure)
                                                            System.out.print("Enter current master password: ");
                                                            String oldPwd = sc.nextLine();

                                                            if (!userService.verifyMasterPassword(userId, oldPwd)) {
                                                                System.out.println("Incorrect current password");
                                                                break;
                                                            }

                                                            System.out.print("Enter new master password: ");
                                                            String newPwd = sc.nextLine();

                                                            userService.resetPassword(userId, newPwd);
                                                            System.out.println("Password updated successfully");
                                                            break;
                                                        }

                                                        case 4:
                                                            break;

                                                        default:
                                                            System.out.println("Invalid choice");
                                                    }
                                                    break;
                                                }


                                                    case 2: {   // Add Password
                                                        System.out.print("Account name: ");
                                                        String account = sc.nextLine();

                                                        System.out.print("Username: ");
                                                        String username = sc.nextLine();

                                                        System.out.print("Password: ");
                                                        String pwd = sc.nextLine();

                                                        passwordService.add(userId, account, username, pwd);
                                                        System.out.println("Password saved");
                                                        break;
                                                    }

                                                    case 3: {   // List Passwords
                                                        System.out.print("Re-enter master password: ");
                                                        String mp = sc.nextLine();

                                                        if (!userService.verifyMasterPassword(userId, mp)) {
                                                            System.out.println("Incorrect master password");
                                                            break;
                                                        }

                                                        passwordService.list(userId);
                                                        break;
                                                    }

                                                    case 4: {   // View Account Password
                                                        System.out.print("Account name: ");
                                                        String account = sc.nextLine();

                                                        System.out.print("Re-enter master password: ");
                                                        String mp = sc.nextLine();

                                                        if (!userService.verifyMasterPassword(userId, mp)) {
                                                            System.out.println("Incorrect master password");
                                                            break;
                                                        }

                                                        String pwd = passwordService.viewPassword(userId, account);
                                                        System.out.println(pwd == null ? "Account not found"
                                                                : "Password: " + pwd);
                                                        break;
                                                    }

                                                    case 5: {   // Update Password
                                                        System.out.print("Account name: ");
                                                        String acc = sc.nextLine();

                                                        System.out.print("New password: ");
                                                        String pwd = sc.nextLine();

                                                        System.out.println(
                                                                passwordService.update(userId, acc, pwd)
                                                                        ? "Password updated"
                                                                        : "Account not found");
                                                        break;
                                                    }

                                                    case 6: {   // Delete Password
                                                        System.out.print("Account name: ");
                                                        String acc = sc.nextLine();

                                                        System.out.println(
                                                                passwordService.delete(userId, acc)
                                                                        ? "Password deleted"
                                                                        : "Account not found");
                                                        break;
                                                    }

                                                    case 7: {   // Logout
                                                        userId = -1;
                                                        System.out.println("Logged out successfully");
                                                        break;
                                                    }

                                                    case 8:
                                                        System.out.println("Exiting application");
                                                        sc.close();
                                                        System.exit(0);

                                                    default:
                                                        System.out.println("Invalid choice");
                                                }
                                            }

                                        } catch (Exception e) {
                                            System.out.println("Error: " + e.getMessage());
                                        }
                                    }
                            }
                            }

                            case 3: {   // Change Password (secure)
                                System.out.print("Enter current master password: ");
                                String oldPwd = sc.nextLine();

                                if (!userService.verifyMasterPassword(userId, oldPwd)) {
                                    System.out.println("Incorrect current password");
                                    break;
                                }

                                System.out.print("Enter new master password: ");
                                String newPwd = sc.nextLine();

                                userService.resetPassword(userId, newPwd);
                                System.out.println("Password updated successfully");
                                break;
                            }

                            case 4:
                                break;

                            default:
                                System.out.println("Invalid choice");
                        }
                        break;
                    }


                        case 2: {   // Add Password
                            System.out.print("Account name: ");
                            String account = sc.nextLine();

                            System.out.print("Username: ");
                            String username = sc.nextLine();

                            System.out.print("Password: ");
                            String pwd = sc.nextLine();

                            passwordService.add(userId, account, username, pwd);
                            System.out.println("Password saved");
                            break;
                        }

                        case 3: {   // List Passwords
                            System.out.print("Re-enter master password: ");
                            String mp = sc.nextLine();

                            if (!userService.verifyMasterPassword(userId, mp)) {
                                System.out.println("Incorrect master password");
                                break;
                            }

                            passwordService.list(userId);
                            break;
                        }

                        case 4: {   // View Account Password
                            System.out.print("Account name: ");
                            String account = sc.nextLine();

                            System.out.print("Re-enter master password: ");
                            String mp = sc.nextLine();

                            if (!userService.verifyMasterPassword(userId, mp)) {
                                System.out.println("Incorrect master password");
                                break;
                            }

                            String pwd = passwordService.viewPassword(userId, account);
                            System.out.println(pwd == null ? "Account not found"
                                    : "Password: " + pwd);
                            break;
                        }

                        case 5: {   // Update Password
                            System.out.print("Account name: ");
                            String acc = sc.nextLine();

                            System.out.print("New password: ");
                            String pwd = sc.nextLine();

                            System.out.println(
                                    passwordService.update(userId, acc, pwd)
                                            ? "Password updated"
                                            : "Account not found");
                            break;
                        }

                        case 6: {   // Delete Password
                            System.out.print("Account name: ");
                            String acc = sc.nextLine();

                            System.out.println(
                                    passwordService.delete(userId, acc)
                                            ? "Password deleted"
                                            : "Account not found");
                            break;
                        }

                        case 7: {   // Logout
                            userId = -1;
                            System.out.println("Logged out successfully");
                            break;
                        }

                        case 8:
                            System.out.println("Exiting application");
                            sc.close();
                            System.exit(0);

                        default:
                            System.out.println("Invalid choice");
                    }
                }

            } catch (Exception e) {
                System.out.println("Error: " + e.getMessage());
            }
        }
}
}